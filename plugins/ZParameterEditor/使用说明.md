# Z参数编辑器使用说明

## 插件概述

Z参数编辑器是一个Cura插件，提供可视化界面来定义随Z高度变化的参数。支持多种参数类型的编辑，包括温度配置文件、速度比例配置文件等，并具备完整的数据持久化功能。

## 主要功能

### 核心特性
- **可视化编辑**: 通过图形界面直观编辑Z高度相关参数
- **多参数支持**: 支持温度、速度比例等多种参数类型
- **数据持久化**: 自动保存和恢复每个模型的参数配置
- **实时预览**: 实时显示参数曲线和数值变化
- **精确控制**: 支持图形点击和数值输入两种编辑方式

### 支持的参数类型
1. **用户速度比例定义** (user_speed_ratio_definition)
   - 范围: 10-200%
   - 用途: 控制不同Z高度的打印速度比例
2. **温度配置文件** (temperature_profile)
   - 范围: 150-300°C
   - 用途: 控制不同Z高度的打印温度
3. **可扩展**: 支持添加更多参数类型

## 界面说明

### 1. 参数类型选择器
- **下拉菜单**: 选择要编辑的参数类型
- **自动切换**: 切换参数类型时自动保存当前数据并加载新类型数据

### 2. 模型信息显示
显示当前选中模型的基本信息：
- **模型高度**: 当前模型的总高度 (mm)
- **自动更新**: 选择不同模型时自动更新信息

### 3. 可视化图表编辑器
- **坐标系统**:
  - 垂直轴(Y轴)：Z高度 (0 到模型高度)
  - 水平轴(X轴)：参数值 (根据参数类型显示单位)
- **控制点**: 蓝色圆点表示参数控制点
- **曲线显示**: 贝塞尔曲线连接各控制点
- **交互操作**:
  - 点击图表空白处：在该位置添加新的参数点
  - 点击现有控制点：删除该参数点
  - 拖拽支持：可拖拽控制点调整位置

### 4. 数值输入控件
- **最小值输入**: 设置参数的最小值范围
- **最大值输入**: 设置参数的最大值范围
- **Z高度输入**: 精确输入Z高度值
- **参数值输入**: 精确输入参数值
- **添加按钮**: 使用输入框的值添加参数点
- **清除按钮**: 删除所有参数点并重置为默认状态

### 5. 操作按钮
- **保存**: 保存当前参数配置到模型数据
- **重置**: 恢复到默认参数配置

## 使用步骤

### 基本使用流程

1. **加载模型**: 在Cura中加载并选择要打印的模型
2. **打开插件**: 点击左侧工具栏中的Z参数编辑器图标
3. **选择参数类型**: 使用下拉菜单选择要编辑的参数类型
4. **设置参数范围**: 根据需要调整最小值和最大值
5. **添加控制点**:
   - **图形方式**: 直接点击图表中的位置添加控制点
   - **数值方式**: 在输入框中输入精确的Z高度和参数值，然后点击"添加"
6. **调整参数**:
   - 点击现有控制点可删除
   - 重新添加可修改参数值
7. **保存配置**: 插件会自动保存配置，也可手动点击"保存"按钮

### 数据持久化特性

- **自动保存**: 每次修改参数时自动保存到模型数据
- **模型关联**: 每个模型的参数配置独立保存
- **会话恢复**: 关闭插件后重新打开会自动恢复之前的配置
- **参数切换**: 切换参数类型时自动保存当前数据并加载目标类型数据

### 速度比例配置示例

假设要在不同高度调整打印速度比例：
1. 选择"用户速度比例定义"参数类型
2. 设置范围：最小值10%，最大值200%
3. 添加控制点：
   - 0mm: 100% (起始正常速度)
   - 5mm: 80% (降低速度提高底层质量)
   - 15mm: 120% (提高速度加快中间部分打印)
   - 模型顶部: 90% (降低速度提高顶部质量)
4. 配置自动保存

### 温度配置示例

假设要在打印过程中调整温度：
1. 选择"温度配置文件"参数类型
2. 设置范围：最小值150°C，最大值300°C
3. 添加控制点：
   - 0mm: 200°C (起始温度)
   - 10mm: 210°C (提高温度改善附着)
   - 20mm: 205°C (降低温度提高精度)
   - 模型顶部: 195°C (降低温度减少拉丝)
4. 配置自动保存

## 注意事项

### 使用建议
- **参数排序**: 控制点会按Z高度自动排序显示
- **数值覆盖**: 相同高度的控制点会被新值替换
- **测试建议**: 建议先在小模型上测试参数效果
- **随时调整**: 可以随时清除重新设置，支持实时预览
- **模型选择**: 确保选中目标模型以获取正确的高度信息

### 功能限制
- **模型依赖**: 需要选中模型才能获取正确的高度信息和保存配置
- **参数范围**: 参数值需要在设定的最小值和最大值范围内
- **数据关联**: 每个模型的参数配置独立存储，不会相互影响

### 故障排除

#### 常见问题
1. **模型高度显示为0或25**
   - 确保已在Cura中选中模型
   - 检查模型是否正确加载
   - 尝试重新选择模型

2. **参数点无法添加**
   - 检查输入值是否在有效范围内（最小值-最大值）
   - 确认Z高度值不超过模型高度
   - 检查数值输入格式是否正确

3. **配置数据丢失**
   - 检查是否正确选择了模型
   - 确认模型文件名没有改变
   - 查看控制台日志获取详细错误信息

4. **图表显示异常**
   - 尝试调整最小值和最大值范围
   - 清除所有控制点后重新添加
   - 检查浏览器控制台是否有JavaScript错误

#### 调试信息
插件提供详细的调试日志，可在Cura控制台中查看：
- `[LOAD_DEBUG]`: 数据加载相关日志
- `[SAVE_DEBUG]`: 数据保存相关日志
- `[MODEL_DEBUG]`: 模型操作相关日志
- `[CHART_DEBUG]`: 图表操作相关日志

## 高级功能

### 数据管理
- **自动备份**: 参数配置自动保存到Cura偏好设置
- **数据导出**: 可通过偏好设置文件备份配置数据
- **批量清理**: 支持清理已删除模型的配置数据

### 扩展开发
- **参数类型扩展**: 可在代码中添加新的参数类型
- **UI定制**: 支持修改界面布局和样式
- **集成接口**: 提供Python API供其他插件调用

### 性能优化
- **延迟加载**: 大模型的高度计算采用延迟加载
- **缓存机制**: 模型高度和参数数据采用缓存机制
- **事件优化**: 场景变化事件进行了防抖处理

## 技术支持

### 文档资源
- **README.md**: 插件基本信息和安装说明
- **开发总结文档**: 详细的开发过程和问题解决方案
- **测试脚本**: test_plugin.py 提供功能测试

### 问题反馈
如遇到问题或有改进建议：
1. 查看Cura控制台日志获取详细错误信息
2. 检查本文档的故障排除部分
3. 参考开发文档了解技术细节
4. 提供详细的问题描述和日志信息

### 版本信息
- **当前版本**: 1.0.0
- **兼容性**: Cura 5.x 系列
- **API版本**: 6.0+
- **最后更新**: 2025年8月
